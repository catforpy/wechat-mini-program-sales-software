// 模板详情页中使用 MediaSwiper 组件的示例代码

// ===== 方法 1：直接在现有页面中集成 =====

// 1. 在 template detail 页面的 <template> 部分替换轮播图

/*
 * 旧代码：
 *
 * <swiper
 *   class="banner-swiper"
 *   :current="currentSwiperIndex"
 *   :indicator-dots="true"
 *   :autoplay="false"
 *   ...
 * >
 *   <swiper-item v-for="(item, index) in bannerList" :key="index">
 *     <image v-if="item.type === 'image'" ... />
 *     <video v-else ... />
 *   </swiper-item>
 * </swiper>
 *
 * 替换为新代码：
 */

<MediaSwiper
  class="banner-swiper"
  :list="bannerList"
  :autoplay="false"
  :interval="5000"
  :circular="true"
  @image-click="previewImage"
  @video-end="onBannerVideoEnd"
/>

// 2. 在 script setup 部分导入组件

import MediaSwiper from '@/components/media/MediaSwiper.vue'

// 3. 注册组件

defineOptions({
  components: {
    MediaSwiper
  }
})

// 4. 数据结构保持不变（已经符合 MediaItem 接口）

const bannerList = ref([
  {
    type: 'image',
    url: 'https://picsum.photos/750/400?random=1',
    title: '首页截图'
  },
  {
    type: 'image',
    url: 'https://picsum.photos/750/400?random=2',
    title: '课程列表'
  },
  {
    type: 'video',
    url: 'https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4',
    thumbnail: 'https://picsum.photos/750/400?random=3',
    poster: 'https://picsum.photos/750/400?random=3',
    title: '功能演示'
  }
])

// 5. 简化事件处理

// 旧代码可以删除：
// - currentSwiperIndex
// - currentVideoIndex
// - playVideo() 方法
// - onSwiperChange() 方法
// - onBannerVideoEnd() 方法简化

const onBannerVideoEnd = (data: any) => {
  console.log('视频播放结束:', data)
  // MediaSwiper 会自动处理切换到下一张
  uni.showToast({
    title: '视频播放结束',
    icon: 'none',
    duration: 1000
  })
}

// 图片预览保持不变
const previewImage = (data: any) => {
  const { index } = data
  const urls = bannerList.value
    .filter(item => item.type === 'image')
    .map(item => item.url)

  const currentIndex = bannerList.value
    .filter(item => item.type === 'image')
    .findIndex(item => bannerList.value.indexOf(item) === index)

  uni.previewImage({
    urls,
    current: currentIndex
  })
}


// ===== 方法 2：创建独立的 Banner 组件 =====

/*
 * 如果希望进一步封装，可以创建独立的 Banner 组件
 * 文件：src/components/TemplateBanner.vue
 */

<template>
  <view class="template-banner">
    <MediaSwiper
      :list="bannerList"
      :autoplay="autoplay"
      :interval="interval"
      :circular="circular"
      @image-click="handleImageClick"
      @video-end="handleVideoEnd"
    />
  </view>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import MediaSwiper from '@/components/media/MediaSwiper.vue'
import type { MediaItem } from '@/components/media/MediaSwiper.vue'

interface Props {
  list: MediaItem[]
  autoplay?: boolean
  interval?: number
  circular?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  autoplay: false,
  interval: 5000,
  circular: true
})

const emit = defineEmits(['imageClick', 'videoEnd'])

const bannerList = ref(props.list)

const handleImageClick = (data: any) => {
  emit('imageClick', data)
}

const handleVideoEnd = (data: any) => {
  emit('videoEnd', data)
}

defineExpose({
  bannerList
})
</script>

<style scoped lang="scss">
@import '@/styles/variables.scss';

.template-banner {
  width: 100%;
  background-color: #000000;

  :deep(.media-swiper-wrapper) {
    height: 400rpx;
  }
}
</style>


// ===== 方法 3：在模板详情页中使用 Banner 组件 =====

/*
 * 文件：src/pages/template/detail/index.vue
 */

<template>
  <view class="template-detail-page">
    <!-- 状态栏占位 -->
    <view class="status-bar"></view>

    <!-- 顶部导航栏 -->
    <view class="navbar">
      <!-- ... -->
    </view>

    <!-- 内容区域 -->
    <scroll-view scroll-y class="content-scroll">
      <!-- 使用 Banner 组件 -->
      <TemplateBanner
        :list="bannerList"
        :autoplay="false"
        @image-click="previewImage"
        @video-end="onBannerVideoEnd"
      />

      <!-- 2. 基本信息卡片 -->
      <view class="info-card">
        <!-- ... -->
      </view>

      <!-- ... -->
    </scroll-view>
  </view>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import TemplateBanner from '@/components/TemplateBanner.vue'
import type { MediaItem } from '@/components/media/MediaSwiper.vue'

defineOptions({
  components: {
    TemplateBanner
  }
})

const bannerList = ref<MediaItem[]>([
  {
    type: 'image',
    url: 'https://picsum.photos/750/400?random=1',
    title: '首页截图'
  },
  {
    type: 'image',
    url: 'https://picsum.photos/750/400?random=2',
    title: '课程列表'
  },
  {
    type: 'video',
    url: 'https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4',
    poster: 'https://picsum.photos/750/400?random=3',
    title: '功能演示'
  }
])

const previewImage = (data: any) => {
  const { index } = data
  const urls = bannerList.value
    .filter(item => item.type === 'image')
    .map(item => item.url)

  uni.previewImage({
    urls,
    current: urls[index]
  })
}

const onBannerVideoEnd = (data: any) => {
  console.log('视频播放结束:', data)
  uni.showToast({
    title: '视频播放结束',
    icon: 'none',
    duration: 1000
  })
}
</script>


// ===== 完整的模板详情页修改示例 =====

/*
 * 这是一个最小化的修改示例，展示如何将现有的轮播图替换为 MediaSwiper
 */

// 修改前（src/pages/template/detail/index.vue）：

/*
<swiper
  class="banner-swiper"
  :current="currentSwiperIndex"
  :indicator-dots="true"
  :autoplay="false"
  :interval="5000"
  :duration="300"
  indicator-color="rgba(255, 255, 255, 0.5)"
  indicator-active-color="#ffffff"
  @change="onSwiperChange"
>
  <swiper-item v-for="(item, index) in bannerList" :key="index">
    <image
      v-if="item.type === 'image'"
      class="banner-image"
      :src="item.url"
      mode="aspectFill"
      @click="previewImage(index)"
    />
    <view v-else class="banner-video-wrapper">
      <video
        v-if="currentVideoIndex === index"
        class="banner-video"
        :src="item.url"
        :poster="item.thumbnail"
        :controls="true"
        :show-play-btn="true"
        :show-center-play-btn="true"
        @ended="onBannerVideoEnd"
      />
      <image
        v-else
        class="banner-video-thumb"
        :src="item.thumbnail"
        mode="aspectFill"
        @click="playVideo(index)"
      />
      <view v-if="currentVideoIndex !== index" class="video-play-btn">
        <text class="play-icon">▶</text>
      </view>
    </view>
  </swiper-item>
</swiper>
*/

// 修改后：

/*
<MediaSwiper
  class="banner-swiper"
  :list="bannerList"
  :autoplay="false"
  :interval="5000"
  :circular="true"
  @image-click="previewImage"
  @video-end="onBannerVideoEnd"
/>
*/

// script 部分需要做的修改：

// 1. 导入组件
import MediaSwiper from '@/components/media/MediaSwiper.vue'

// 2. 注册组件
defineOptions({
  components: {
    MediaSwiper
  }
})

// 3. 可以删除以下变量和方法：
// - currentSwiperIndex
// - currentVideoIndex
// - playVideo()
// - onSwiperChange()
// - onBannerVideoEnd() 可以保留，但参数变化

// 4. 修改事件处理函数参数
const previewImage = (data: any) => {
  const { index, item } = data
  // ... 预览逻辑
}

const onBannerVideoEnd = (data: any) => {
  const { index, item } = data
  // MediaSwiper 会自动切换到下一张
  uni.showToast({
    title: '视频播放结束',
    icon: 'none'
  })
}


// ===== 优势对比 =====

/*
 * 使用 MediaSwiper 组件的优势：
 *
 * 1. 代码量减少：从 ~80 行减少到 ~10 行
 * 2. 逻辑简化：不需要管理 currentSwiperIndex、currentVideoIndex 等状态
 * 3. 功能完整：视频播放、暂停、结束等逻辑都由组件处理
 * 4. 易于维护：轮播逻辑集中在一个组件中
 * 5. 可复用：其他页面也可以使用相同的组件
 * 6. 统一体验：所有使用该组件的页面交互一致
 *
 * 性能优势：
 * 1. 视频懒加载：只有点击时才加载视频组件
 * 2. 自动内存管理：组件内部处理视频的创建和销毁
 * 3. 优化的事件处理：避免重复监听和内存泄漏
 */


// ===== 迁移检查清单 =====

/*
 * ✅ 导入 MediaSwiper 组件
 * ✅ 注册组件
 * ✅ 替换 <swiper> 为 <MediaSwiper>
 * ✅ 删除不必要的状态变量
 * ✅ 更新事件处理函数
 * ✅ 测试图片点击预览
 * ✅ 测试视频播放
 * ✅ 测试视频播放结束后自动切换
 * ✅ 测试手动滑动
 */
