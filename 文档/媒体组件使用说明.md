# åª’ä½“ç»„ä»¶ä½¿ç”¨è¯´æ˜

## ç»„ä»¶æ¦‚è¿°

æœ¬é¡¹ç›®æä¾›äº†ä¸¤ä¸ªæ ¸å¿ƒåª’ä½“ç»„ä»¶ï¼Œé‡‡ç”¨å·¥å‚æ¨¡å¼è®¾è®¡ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤ï¼š

1. **MediaSwiper** - åª’ä½“è½®æ’­ç»„ä»¶ï¼ˆæ”¯æŒå›¾ç‰‡ã€è§†é¢‘æ··åˆè½®æ’­ï¼‰
2. **VideoPlayer** - è§†é¢‘æ’­æ”¾å™¨ç»„ä»¶ï¼ˆæ”¯æŒå¤šç§æ’­æ”¾å™¨ç±»å‹ï¼‰

---

## ä¸€ã€MediaSwiper åª’ä½“è½®æ’­ç»„ä»¶

### åŠŸèƒ½ç‰¹æ€§

- âœ… æ”¯æŒå›¾ç‰‡ã€è§†é¢‘æ··åˆè½®æ’­
- âœ… è§†é¢‘æ’­æ”¾æ—¶è‡ªåŠ¨æš‚åœè½®æ’­
- âœ… è§†é¢‘æ’­æ”¾ç»“æŸåè‡ªåŠ¨æ¢å¤è½®æ’­
- âœ… è‡ªå®šä¹‰æŒ‡ç¤ºå™¨
- âœ… å¾ªç¯è½®æ’­
- âœ… å®Œæ•´çš„äº‹ä»¶å›è°ƒ

### åŸºç¡€ç”¨æ³•

```vue
<template>
  <MediaSwiper
    :list="mediaList"
    :autoplay="true"
    :interval="5000"
    @image-click="onImageClick"
    @video-end="onVideoEnd"
  />
</template>

<script setup lang="ts">
import MediaSwiper from '@/components/media/MediaSwiper.vue'

const mediaList = [
  {
    type: 'image',
    url: 'https://example.com/image1.jpg'
  },
  {
    type: 'image',
    url: 'https://example.com/image2.jpg'
  },
  {
    type: 'video',
    url: 'https://example.com/video.mp4',
    poster: 'https://example.com/poster.jpg'
  }
]
</script>
```

### Props å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| list | `MediaItem[]` | `[]` | åª’ä½“åˆ—è¡¨ï¼ˆå¿…éœ€ï¼‰ |
| autoplay | `boolean` | `true` | æ˜¯å¦è‡ªåŠ¨è½®æ’­ |
| interval | `number` | `5000` | è½®æ’­é—´éš”ï¼ˆæ¯«ç§’ï¼‰ |
| duration | `number` | `300` | åˆ‡æ¢åŠ¨ç”»æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ |
| circular | `boolean` | `true` | æ˜¯å¦å¾ªç¯è½®æ’­ |
| showIndicator | `boolean` | `true` | æ˜¯å¦æ˜¾ç¤ºæŒ‡ç¤ºå™¨ |
| customIndicator | `boolean` | `false` | æ˜¯å¦ä½¿ç”¨è‡ªå®šä¹‰æŒ‡ç¤ºå™¨ |
| indicatorColor | `string` | `'rgba(255, 255, 255, 0.5)'` | æŒ‡ç¤ºå™¨é¢œè‰² |
| indicatorActiveColor | `string` | `'#ffffff'` | å½“å‰æŒ‡ç¤ºå™¨é¢œè‰² |
| imageMode | `string` | `'aspectFill'` | å›¾ç‰‡å¡«å……æ¨¡å¼ |
| videoPlayerType | `string` | `'uniapp'` | è§†é¢‘æ’­æ”¾å™¨ç±»å‹ |
| videoObjectFit | `string` | `'contain'` | è§†é¢‘å¡«å……æ¨¡å¼ |
| defaultPoster | `string` | `''` | é»˜è®¤è§†é¢‘å°é¢ |

### MediaItem ç±»å‹å®šä¹‰

```typescript
interface MediaItem {
  type: 'image' | 'video' | 'custom'  // åª’ä½“ç±»å‹
  url: string                         // èµ„æºURL
  poster?: string                     // è§†é¢‘å°é¢
  thumbnail?: string                  // ç¼©ç•¥å›¾ï¼ˆåŒposterï¼‰
  title?: string                      // æ ‡é¢˜
  [key: string]: any                  // å…¶ä»–è‡ªå®šä¹‰å­—æ®µ
}
```

### Events äº‹ä»¶

| äº‹ä»¶å | å‚æ•° | è¯´æ˜ |
|--------|------|------|
| change | `{ index, item }` | swiperåˆ‡æ¢æ—¶è§¦å‘ |
| imageClick | `{ index, item }` | å›¾ç‰‡ç‚¹å‡»æ—¶è§¦å‘ |
| imageLoad | `{ index, item }` | å›¾ç‰‡åŠ è½½å®Œæˆæ—¶è§¦å‘ |
| imageError | `{ index, item }` | å›¾ç‰‡åŠ è½½é”™è¯¯æ—¶è§¦å‘ |
| videoPlay | `{ index, item }` | è§†é¢‘æ’­æ”¾æ—¶è§¦å‘ |
| videoPause | `{ index, item }` | è§†é¢‘æš‚åœæ—¶è§¦å‘ |
| videoEnd | `{ index, item }` | è§†é¢‘æ’­æ”¾ç»“æŸæ—¶è§¦å‘ |
| videoError | `{ index, item }` | è§†é¢‘é”™è¯¯æ—¶è§¦å‘ |

### Methods æ–¹æ³•ï¼ˆé€šè¿‡ ref è°ƒç”¨ï¼‰

```vue
<template>
  <MediaSwiper ref="swiperRef" :list="mediaList" />
</template>

<script setup>
const swiperRef = ref()

// åˆ‡æ¢åˆ°æŒ‡å®šç´¢å¼•
swiperRef.value.slideTo(2)

// æ’­æ”¾æŒ‡å®šè§†é¢‘
swiperRef.value.playVideo(2)

// è·å–å½“å‰ç´¢å¼•
const currentIndex = swiperRef.value.getCurrentIndex()

// è·å–æ­£åœ¨æ’­æ”¾çš„è§†é¢‘ç´¢å¼•
const playingIndex = swiperRef.value.getPlayingVideoIndex()
</script>
```

---

## äºŒã€VideoPlayer è§†é¢‘æ’­æ”¾å™¨ç»„ä»¶

### åŠŸèƒ½ç‰¹æ€§

- âœ… æ”¯æŒå¤šç§æ’­æ”¾å™¨ç±»å‹ï¼ˆå·¥å‚æ¨¡å¼ï¼‰
- âœ… ç»Ÿä¸€çš„APIæ¥å£
- âœ… é€šè¿‡é…ç½®åˆ‡æ¢æ’­æ”¾å™¨
- âœ… æ”¯æŒç‚¹æ’­ã€ç›´æ’­ã€æ¨æµ

### æ”¯æŒçš„æ’­æ”¾å™¨ç±»å‹

| ç±»å‹å€¼ | è¯´æ˜ | çŠ¶æ€ |
|--------|------|------|
| `uniapp` | UniappåŸç”Ÿvideoç»„ä»¶ | âœ… å·²å®ç° |
| `tencent-video` | è…¾è®¯äº‘ç‚¹æ’­æ’­æ”¾å™¨ | ğŸš§ å¾…æ¥å…¥SDK |
| `tencent-live-player` | è…¾è®¯äº‘ç›´æ’­æ’­æ”¾å™¨ | ğŸš§ å¾…æ¥å…¥SDK |
| `tencent-live-pusher` | è…¾è®¯äº‘ç›´æ’­æ¨æµ | ğŸš§ å¾…æ¥å…¥SDK |
| `ali-video` | é˜¿é‡Œäº‘ç‚¹æ’­æ’­æ”¾å™¨ | ğŸš§ å¾…æ¥å…¥SDK |
| `ali-live-player` | é˜¿é‡Œäº‘ç›´æ’­æ’­æ”¾å™¨ | ğŸš§ å¾…æ¥å…¥SDK |
| `ali-live-pusher` | é˜¿é‡Œäº‘ç›´æ’­æ¨æµ | ğŸš§ å¾…æ¥å…¥SDK |

### åŸºç¡€ç”¨æ³•

```vue
<template>
  <!-- ä½¿ç”¨é»˜è®¤æ’­æ”¾å™¨ï¼ˆå…¨å±€é…ç½®ï¼‰ -->
  <VideoPlayer
    :src="videoUrl"
    :poster="posterUrl"
    @play="onPlay"
    @ended="onEnded"
  />

  <!-- æŒ‡å®šæ’­æ”¾å™¨ç±»å‹ -->
  <VideoPlayer
    src="https://example.com/video.mp4"
    player-type="tencent-video"
    :license-url="licenseUrl"
    @play="onPlay"
  />
</template>

<script setup lang="ts">
import VideoPlayer from '@/components/media/VideoPlayer.vue'

const videoUrl = ref('https://example.com/video.mp4')
const posterUrl = ref('https://example.com/poster.jpg')
</script>
```

### Props å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| src | `string` | `''` | è§†é¢‘åœ°å€ï¼ˆå¿…éœ€ï¼‰ |
| poster | `string` | `''` | å°é¢å›¾ |
| playerType | `string` | å…¨å±€é…ç½® | æ’­æ”¾å™¨ç±»å‹ |
| licenseUrl | `string` | `''` | è…¾è®¯äº‘æ’­æ”¾å™¨license |
| autoplay | `boolean` | `false` | è‡ªåŠ¨æ’­æ”¾ |
| controls | `boolean` | `true` | æ˜¾ç¤ºæ§åˆ¶æ  |
| loop | `boolean` | `false` | å¾ªç¯æ’­æ”¾ |
| muted | `boolean` | `false` | é™éŸ³ |
| showPlayBtn | `boolean` | `true` | æ˜¾ç¤ºæ’­æ”¾æŒ‰é’® |
| showCenterPlayBtn | `boolean` | `true` | æ˜¾ç¤ºä¸­å¿ƒæ’­æ”¾æŒ‰é’® |
| showProgress | `boolean` | `true` | æ˜¾ç¤ºè¿›åº¦æ¡ |
| objectFit | `string` | `'contain'` | å¡«å……æ–¹å¼ |
| pushUrl | `string` | `''` | æ¨æµåœ°å€ |
| orientation | `string` | `'vertical'` | æ¨æµæ–¹å‘ |
| cameraPosition | `string` | `'front'` | æ‘„åƒå¤´ä½ç½® |
| beauty | `number` | `5` | ç¾é¢œçº§åˆ« |

### Events äº‹ä»¶

| äº‹ä»¶å | è¯´æ˜ |
|--------|------|
| play | è§†é¢‘æ’­æ”¾æ—¶è§¦å‘ |
| pause | è§†é¢‘æš‚åœæ—¶è§¦å‘ |
| ended | è§†é¢‘æ’­æ”¾ç»“æŸæ—¶è§¦å‘ |
| error | è§†é¢‘é”™è¯¯æ—¶è§¦å‘ |
| timeupdate | æ’­æ”¾è¿›åº¦æ›´æ–°æ—¶è§¦å‘ |
| fullscreenchange | å…¨å±çŠ¶æ€æ”¹å˜æ—¶è§¦å‘ |
| statechange | æ¨æµçŠ¶æ€æ”¹å˜æ—¶è§¦å‘ |
| pusherror | æ¨æµé”™è¯¯æ—¶è§¦å‘ |

---

## ä¸‰ã€å…¨å±€é…ç½®

### é…ç½®æ–‡ä»¶ä½ç½®

`@/config/media.config.ts`

### ä¿®æ”¹é»˜è®¤æ’­æ”¾å™¨

```typescript
// @/config/media.config.ts
import { PlayerType } from '@/config/media.config'

export const mediaConfig = {
  // ä¿®æ”¹ä¸ºä½¿ç”¨è…¾è®¯äº‘æ’­æ”¾å™¨
  default: PlayerType.TENCENT_VIDEO,

  players: {
    uniapp: { /* ... */ },
    tencent: {
      licenseUrl: 'https://license.vod2.myqcloud.com/license/v2/xxx'
    },
    ali: { /* ... */ }
  }
}
```

### åŠ¨æ€åˆ‡æ¢æ’­æ”¾å™¨

```typescript
import { setPlayerType, PlayerType } from '@/config/media.config'

// åˆ‡æ¢ä¸ºé˜¿é‡Œäº‘æ’­æ”¾å™¨
setPlayerType(PlayerType.ALI_VIDEO)
```

---

## å››ã€åœ¨æ¨¡æ¿è¯¦æƒ…é¡µä¸­ä½¿ç”¨

### æ›¿æ¢ç°æœ‰è½®æ’­å›¾

```vue
<!-- src/pages/template/detail/index.vue -->
<template>
  <view class="banner-section">
    <MediaSwiper
      :list="bannerList"
      :autoplay="true"
      :interval="5000"
      :circular="true"
      @image-click="previewImage"
      @video-end="onBannerVideoEnd"
    />
  </view>
</template>

<script setup lang="ts">
import MediaSwiper from '@/components/media/MediaSwiper.vue'

const bannerList = ref([
  { type: 'image', url: 'https://xxx.com/banner1.jpg' },
  { type: 'image', url: 'https://xxx.com/banner2.jpg' },
  { type: 'video', url: 'https://xxx.com/video.mp4', poster: 'https://xxx.com/poster.jpg' }
])
</script>
```

---

## äº”ã€é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ media/
â”‚       â”œâ”€â”€ MediaSwiper.vue          # åª’ä½“è½®æ’­ç»„ä»¶
â”‚       â”œâ”€â”€ VideoPlayer.vue          # è§†é¢‘æ’­æ”¾å™¨ç»Ÿä¸€å…¥å£
â”‚       â””â”€â”€ players/                 # å„æ’­æ”¾å™¨å®ç°
â”‚           â”œâ”€â”€ UniappVideoPlayer.vue
â”‚           â”œâ”€â”€ TencentVideoPlayer.vue
â”‚           â”œâ”€â”€ TencentLivePlayer.vue
â”‚           â”œâ”€â”€ TencentLivePusher.vue
â”‚           â”œâ”€â”€ AliVideoPlayer.vue
â”‚           â”œâ”€â”€ AliLivePlayer.vue
â”‚           â””â”€â”€ AliLivePusher.vue
â””â”€â”€ config/
    â””â”€â”€ media.config.ts              # åª’ä½“é…ç½®æ–‡ä»¶
```

---

## å…­ã€ä¼˜åŠ¿æ€»ç»“

### 1. å·¥å‚æ¨¡å¼è®¾è®¡
- ä¸€ä¸ªç»„ä»¶æ¥å£ï¼Œæ”¯æŒå¤šç§æ’­æ”¾å™¨
- é…ç½®åŒ–åˆ‡æ¢ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç 

### 2. è§£è€¦åˆ
- ä¸šåŠ¡ä»£ç ä¸å…·ä½“æ’­æ”¾å™¨å®ç°è§£è€¦
- æ˜“äºæµ‹è¯•å’Œç»´æŠ¤

### 3. æ˜“æ‰©å±•
- æ–°å¢æ’­æ”¾å™¨ç±»å‹åªéœ€ï¼š
  1. åˆ›å»ºæ–°çš„æ’­æ”¾å™¨ç»„ä»¶
  2. åœ¨ VideoPlayer ä¸­æ³¨å†Œ
  3. æ·»åŠ é…ç½®æšä¸¾

### 4. çµæ´»é…ç½®
- æ”¯æŒå…¨å±€é…ç½®
- æ”¯æŒç»„ä»¶çº§é…ç½®
- æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢

---

## ä¸ƒã€åç»­æ‰©å±•æ­¥éª¤

### æ¥å…¥è…¾è®¯äº‘æ’­æ”¾å™¨

1. å®‰è£…è…¾è®¯äº‘æ’­æ”¾å™¨å°ç¨‹åºSDK
2. åœ¨ `pages.json` ä¸­å¼•å…¥ç»„ä»¶
3. å®Œå–„ `TencentVideoPlayer.vue` å®ç°
4. ç”³è¯· license å¹¶é…ç½®

### æ¥å…¥é˜¿é‡Œäº‘æ’­æ”¾å™¨

1. å®‰è£…é˜¿é‡Œäº‘æ’­æ”¾å™¨å°ç¨‹åºSDK
2. åœ¨ `pages.json` ä¸­å¼•å…¥ç»„ä»¶
3. å®Œå–„ `AliVideoPlayer.vue` å®ç°
4. é…ç½®é‰´æƒä¿¡æ¯

---

## å…«ã€æ³¨æ„äº‹é¡¹

1. **ç»„ä»¶æ³¨å†Œ**ï¼šæ–°åˆ›å»ºçš„æ’­æ”¾å™¨ç»„ä»¶éœ€è¦åœ¨ `VideoPlayer.vue` ä¸­æ³¨å†Œ
2. **å¹³å°å·®å¼‚**ï¼šä¸åŒå°ç¨‹åºå¹³å°çš„æ’­æ”¾å™¨å¯èƒ½æœ‰å·®å¼‚ï¼Œéœ€è¦æµ‹è¯•
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šè§†é¢‘æ’­æ”¾å™¨å»ºè®®ä½¿ç”¨æ‡’åŠ è½½
4. **é”™è¯¯å¤„ç†**ï¼šåšå¥½æ’­æ”¾å™¨åŠ è½½å¤±è´¥çš„é™çº§å¤„ç†
5. **Licenseç®¡ç†**ï¼šè…¾è®¯äº‘ç­‰æ’­æ”¾å™¨éœ€è¦ç”³è¯·licenseï¼Œæ³¨æ„ä¿å¯†
